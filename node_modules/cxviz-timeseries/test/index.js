'use strict';

var test = require('tape')
var jsdom = require('jsdom')
var data = require('concurix-waterfalldata')
var xform = require('concurix-waterfalltransform')
var sample1 = xform.enhanceWaterfall(data.expressExample)

var FlameGraph = require('../')


jsdom.env(
  '<body></body>',
  ['http://code.jquery.com/jquery.js'],
  function (errors, window) {

    var $ = window.$
    var el = window.document.createElement('div')
    var graph = new FlameGraph()
    graph.init(el)
    var waterfall = sample1.waterfalls[5]
    graph.update(waterfall)

    test('log el html', function (t) {
      // console.log(waterfall.costTree);
      console.log(el.innerHTML);
      t.end()
    })

    test('returns el', function (t) {
      t.equal(el, graph.el)
      t.end()
    })

    test('attaches svg', function (t) {
      var $svg = $(graph.el).find('svg')
      t.ok($svg.length > 0)
      t.end()
    })

    test('creates initial .cost rect', function (t) {
      var $cost = $(graph.el).find('g.cxviz-flame-item')
      t.ok($cost.length > 0)
      t.end()
    })
  }
)
