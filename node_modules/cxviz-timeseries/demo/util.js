'use strict';

var m = require('moment')

module.exports.convertTimeseries = function convertTimeseries(t){
  console.log('convert timeseries', t)
  var ret = t.map(function(d){
    var item = {
      _t: m(d.ts).unix()*1000,
      'Process Heap Total': d['p_mt'].low,
      'Process Heap Used': d['p_mu'].low,
      'Process RSS': d['p_mr'].low,
      __data: d
    }
    return item
  })
  return ret.sort(function(a,b){ return a._t - b._t;})
}

module.exports.convertTransactions = function convertTransactions(t, key, trans){
  console.log('convert timeseries', t)
  var ret = t[key][trans].map(function(d){
    var item = {
      _t: m(d.ts).unix()*1000,
      'Transaction time stddev': {
        min: d.mean - d.sd,
        max: d.mean + d.sd
      },
      'Transaction time min/max': {
        min: d.min,
        max: d.max
      },
      'Number of calls': d.n
    }
    return item
  })
  return ret.sort(function(a,b){ return a._t - b._t;})
}
