'use strict';

var d3  = require('d3')
var key = require('./key')

function Work (viz) {
  if (!(this instanceof Work)){
    return new Work(viz)
  }
  this.viz = viz
}

Work.prototype.updateSel = function updateSel(sel, expanded, data){
  var self = this
  var work = data.eventLoopAgg.filter(function(d){ return d.type == 'fn'})
  var update = sel.selectAll('.cxviz-eventloop-work-item').data(work, key)
  update.enter().append('rect')
    .attr('class', 'cxviz-eventloop-work-item')

  update.attr('width', function(d) { if( d.cxvEL.layout.width < 0) { return 0;} return d.cxvEL.layout.width })
    .attr('height', function(d){ return expanded ? d.cxvEL.layout.height - 4 : (d.cxvEL.layout.height / 2) -2 })
    .attr('fill', function(d) { return self.viz.color.moduleColor(d.costSummary.topMods[0].name) })
    .attr('stroke', function(d){ return d3.rgb(self.viz.color.moduleColor(d.costSummary.topMods[0].name)).darker()})
    .attr('stroke-width', '1px')
    .attr('x', function (d) { return d.cxvEL.layout.x})
    .attr('y', function (d) { return d.cxvEL.layout.y + 2 })

  update.exit().remove()
}

module.exports = Work
