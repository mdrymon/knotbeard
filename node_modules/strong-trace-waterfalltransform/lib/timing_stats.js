"use strict";

module.exports = timingStats

function timingStats(waterfall) {
  var jsMicros = 0
  var lastEnd = 0.001
  waterfall.segments.forEach(function (seg) {
    if (seg.type === "fn" && seg.depth === 1) {
      jsMicros += seg.inclusive
    }
    if (seg.end > lastEnd) {
      lastEnd = seg.end
    }
  })

  // These summary stats are *PER INSTANCE*
  if (waterfall.timing_stats == null) {
    waterfall.timing_stats = {}
  }
  waterfall.timing_stats.jsMicros = jsMicros
  waterfall.timing_stats.totalMicros = lastEnd
  waterfall.timing_stats.percentBlocked = ((jsMicros / lastEnd)*100)
  waterfall.timing_stats.percentAsync = ((1-(jsMicros / lastEnd))*100)
}
