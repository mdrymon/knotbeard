"use strict";

module.exports.aggregateStats = function aggregateStats(waterfall){
  var aggStats = {}
  var total = 0

  waterfall.waterfalls.forEach(function computeWaterfallStats(d){
    d.stats = module.exports.waterfallStats(d)
    total += d.stats.total_duration
  })

  aggStats.total_duration = total

  waterfall.aggregateStats = aggStats
  return waterfall
}

module.exports.waterfallStats = function waterfallStats(waterfall){
  var max = 0
  waterfall.segments.forEach(function maxEnd(d){
    if( d.end > max ){
      max = d.end
    }
  })
  var stats = {
    duration: max,
    total_duration:  max * waterfall.instance_count
  }
  return stats
}
