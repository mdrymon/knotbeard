'use strict';
var test  = require('tape')
var xform = require('../index')

var data = require('strong-trace-waterfalldata')


test('simple waterfall enchance', function(t){
  var copy = JSON.parse(JSON.stringify(data.expressExample))
  var waterfall = xform.enhanceWaterfall(copy)
  t.assert("jsMicros" in waterfall.summary_stats, 'jsMicros exists')
  t.assert("totalMicros" in waterfall.summary_stats, 'totalMicros exists')
  t.assert("windowMicros" in waterfall.summary_stats, 'windowMicros exists')
  t.assert("percentBlocked" in waterfall.summary_stats, 'percentBlocked exists')
  t.assert("percentAsync" in waterfall.summary_stats, 'percentAsync exists')
  t.assert("percentOperating" in waterfall.summary_stats, 'percentOperating exists')
  t.assert("percentIdle" in waterfall.summary_stats, 'percentIdle exists')
  checkPercent(t, waterfall.summary_stats.percentBlocked)
  checkPercent(t, waterfall.summary_stats.percentAsync)
  checkPercent(t, waterfall.summary_stats.percentOperating)
  checkPercent(t, waterfall.summary_stats.percentIdle)
  t.assert(waterfall, 'waterfall found')
  t.end()
})

function checkPercent(t, percent){
  // console.log('percent is ', percent)
  t.assert(percent >= 0.0, 'percent is greater than or equal to 0')
  t.assert(percent <= 100.0, 'percent is less than or equal to 100')
}
